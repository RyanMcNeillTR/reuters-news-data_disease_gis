---
title: "Adding data - Allison's work"
output: word_document
---

Set working directory for Allison's Windows laptop

```{r}

setwd("C:/Users/0146156/Documents/mb_checks/reuters-news-data_disease_gis")

```

Load libraries

```{r}

library(tidyverse)
library(sf)
library(ggplot2)
library(rnaturalearth)
library(rnaturalearthdata)

```

Get GADM data. 

```{r}

st_layers("./input_data/Bangladesh/gadm/gadm36_BGD_gpkg/gadm36_BGD.gpkg")

bgd_gadm_2 <- st_read("./input_data/Bangladesh/gadm/gadm36_BGD_gpkg/gadm36_BGD.gpkg",
                      layer = "gadm36_BGD_2") %>%
              janitor::clean_names()

bgd_gadm_3 <- st_read("./input_data/Bangladesh/gadm/gadm36_BGD_gpkg/gadm36_BGD.gpkg",
                      layer = "gadm36_BGD_3") %>%
              janitor::clean_names()

bgd_gadm_4 <- st_read("./input_data/Bangladesh/gadm/gadm36_BGD_gpkg/gadm36_BGD.gpkg",
                      layer="gadm36_BGD_4") %>%
              janitor::clean_names()

st_layers("./input_data/India/gadm36_IND.gpkg")

ind_gadm_3 <- st_read("./input_data/India/gadm36_IND.gpkg",
                      layer = "gadm36_IND_3") %>%
              janitor::clean_names()

```

Get other spatial data.

```{r}

st_layers("./input_data/India/Kerala")

ind_taluks <- st_read("./input_data/India/Kerala", layer = "taluk") %>%
  rename(geom = geometry, oid = OID_, taluk = TALUK, state = STATE, district = DISTRICT)

st_layers("C:/Users/0146156/Documents/mb_checks/stanford_level_3")

phl_level_3 <- st_read("C:/Users/0146156/Documents/mb_checks/stanford_level_3")

```

Setting up function that returns variables based on single GADM polygon.

```{r}

grab_polygon <-function(geom, id) {
  geom %>% select(poly_geom = geom) %>% 
           mutate(point_geom = st_centroid(poly_geom),
                  precision = "centroid",
                  reuters_id = id,
                  country_iso = "BGD")
}

```


#bgd_90

Viral sequence is listed as a primary case in a male patient in April 2018 Rahman et al 2021, [here](https://www.sciencedirect.com/science/article/pii/S1201971220322451#tbl0020). District is Rajshahi, no upazilla mentioned. 

*** Coding to district

```{r}

bgd_90 <- bgd_gadm_2 %>% filter(str_detect(name_2, "Rajshahi")) %>%
  grab_polygon(90)

```

#bgd_91

Viral sequence is listed as a primary case in a 26 year old male patient in February 2018 in Rahman et al 2021, [here](https://www.sciencedirect.com/science/article/pii/S1201971220322451#tbl0020). District is Faridpur, no upazilla mentioned.

*** Coding to Faridpur district

```{r}

bgd_91 <- bgd_gadm_2 %>% filter(str_detect(name_2, "Faridpur")) %>%
  grab_polygon(91)

```

#bgd_92

Viral sequence is listed as a primary case in a 13 year old male in 2017 in Rahman et al 2021, [here](https://www.sciencedirect.com/science/article/pii/S1201971220322451#tbl0020). Location given is Uttar Raghobpur in Pabna district.

Uttar Raghobpur is not an upazilla or a union. [This website](https://www.thebangladesh.net/rajshahi-division/pabna-district/pabna-sadar-upazila-pabna/malanchi-union-pabna/uttar-raghabpur-mouza-pabna-sadar-pabna.html) suggests it is a lower administrative division called a 'mouza'. The site says it is in Malanchi union of Pabna Sadar, which is in GADM.

The small area atlas [here](http://203.112.218.65:8008/WebTestApplication/userfiles/Image/Atlas/Pabna.pdf) confirms on page 40 that Uttar Raghabpur is part of Malanchi union.

*** Coding to Malanchi for now, but could later code to the mouza 

```{r}

bgd_92 <- bgd_gadm_4 %>% filter(str_detect(name_2, "Pabna")) %>%
  filter(str_detect(name_4, "Malanchi")) %>%
  grab_polygon(92)

```
#bgd_93

Viral sequence is listed as a primary case in a 12 year old male in 2017 in Rahman et al 2021, [here](https://www.sciencedirect.com/science/article/pii/S1201971220322451#tbl0020). Location given is Uttar Raghobpur in Pabna district. Location is apparently Joykalidangi, Faridpur, but "Joykalidangi" does not exist as written outside this academic paper.

The given date is February 15, 2017. IEDCR's site says they investigated an encephalities cluster in Faridpur in late January, see [here](https://old.iedcr.gov.bd/website/index.php/outbreak/203-outbreak2017)

```{r}

bgd_gadm_4 %>% filter(str_detect(name_4, "Dangi"))

```

There is a Dangi union in Faridpur. 

No information about this outbreak in other sources.

*** Not coding for now.

#bgd_98

This adds a second location to the incident first described in bgd_41, see notes there.

```{r}

bgd_98 <- bgd_gadm_3 %>% filter(str_detect(name_3, "Khetlal")) %>%
  grab_polygon(98)
  
```


#phl_99

This adds a second location to the incident described in phl_22, see notes there. 

```{r}

phl_99 <- phl_level_3 %>% filter(str_detect(name_3, "Midtungok")) %>%
  rename(geom = geometry) %>%
  grab_polygon(99) %>% 
  mutate(country_iso = "PHL")

```

#bgd_101 / bgd_102 / bgd_103 / bgd_104

All three of these are drawn from an archived WHO table which has been incorporated into for example Deka (CDC's) data but not Metabiota's database. One academic paper strongly suggests they are all connected to the well documented 2012 Joypurhat outbreak but it is not written by local experts and may be a simple misinterpretation of the WHO data: "The final outbreak was in 2012 in Joypurhat, Rajshshi, Natore, and Rajbari with a fatality rate of 83% (n=12)." (paper here)[https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6415930/]

Sought more details from IECDR website, ProMED, Daily STar, BDNews, FluTrackers, Factiva and general Google searches.

Rajshahi:

A little concerned this is a coding error because one of the Joypurhat cases apparently died at a hospital in Rajshahi. See ProMED: "Of the 5 deaths, 2 are from Khetlal and the others from the municipality. They died in Ziaur Rahman Medical College Hospital in Bogra and Rajshahi Medical College Hospital. On 21 Jan [2012], a 5-member IECDR expert team went to Bogra and Rajshahi to collect blood and other samples." (source)[https://promedmail.org/promed-post/?id=1022056]

There is a slightly better document Rajshani case for 2013, which we coded under bgd_34. 

Then again it is clearly included in the WHO's reporting table, archived online (here)[http://web.archive.org/web/20190922101016/http://www.searo.who.int/entity/emerging_diseases/links/nipah_virus_outbreaks_sear/en/]

Natore, Rajbari, Gopalganj: 

No indication of a case there in other sources.

*** Not coding these

#bgd_105

This is a potential cause in Pataukhali district, pulled from an archived news story. After discussion with Deb, excluding because time from sap drinking to death seems too short.

"Source: The Daily Star, Staff Correspondent
Date: 10 February 2012
Nipah virus claimed the life of an SSC examinee at Patuakhali General Hospital yesterday. The victim,
Nargis Akhter, 16, daughter of Hasan Sikder of Gabua village under Patuakhali Sadar upazila, was
appearing in the ongoing SSC examinee from Gabua Janata High School. Family and hospital sources said
Nargis fell sick after having date juice at around 8:00am. She was taken to the hospital where she died at
around 1:30pm."
[Archived story](https://web.archive.org/web/20120412182445/http://saarc-sdmc.nic.in/pdf/saarc_news/news227.pdf)

#bgd_106

Viral sequence is listed as a primary case in a 7 year old male in Rahman et al 2021, [here](https://www.sciencedirect.com/science/article/pii/S1201971220322451#tbl0020). District is Kurigram and subdistrict Fulbari. 

IECDR's list of 2013 cases lists a 7 year old male who died in Kurigram that year.

*** Coding to Fulbari upazila, which in GADM is transliterated as 'Phulbari'

```{r}

bgd_106 <- bgd_gadm_3 %>% filter(str_detect(name_2, "Kurigram")) %>%
  filter(str_detect(name_3, "Phulbari")) %>%
  grab_polygon(106)

```
#bgd_107

Viral sequence is listed as a primary case in a 7 year old male in Rahman et al 2021, [here](https://www.sciencedirect.com/science/article/pii/S1201971220322451#tbl0020). District is Gaibandha and subdistrict Polashbari. 

IEDCR's list of 2013 cases includes a 9 year old male who died in Gaibandha that year.

*** Coding to Palashbari upazilla 

```{r}

bgd_107 <- bgd_gadm_3 %>% filter(str_detect(name_3, "Palashbari")) %>%
  grab_polygon(107)

```

#bgd_108

Viral sequence is listed as a primary case in a 43 year old male in Rahman et al 2021, [here](https://www.sciencedirect.com/science/article/pii/S1201971220322451#tbl0020). District is Pabna and subdistrict is Chatmohor. 

IEDCR's list of 2013 cases includes a 43 year old male who died in Pabna that year, and a three year old in the same district who survived. 

From BDNews24 via ProMED: "The new deaths were from Pabna and Rajshahi while one 8-month old boy is struggling for life in the Rajshahi Medical College Hospital." [link](https://promedmail.org/promed-post/?id=1518442)

*** Coding to Chatmohar upazilla

```{r}

bgd_108 <- bgd_gadm_3 %>% filter(str_detect(name_3, "Chatmohar")) %>%
  grab_polygon(108)

```

#bgd_109

Viral sequence is listed as a primary case in a 48 year old male in Rahman et al 2021, [here](https://www.sciencedirect.com/science/article/pii/S1201971220322451#tbl0020). District is Nilphamari and subdistrict is Sayedpur. 

IEDCR's list of 2013 cases includes a 48 year old male who died in Nilphamari that year.

*** Coding to Sayedpur upazilla, transliterated in GADM to Saidpur

```{r}

bgd_109 <- bgd_gadm_3 %>% filter(str_detect(name_3, "Saidpur")) %>%
  grab_polygon(109)

```

#bgd_110

Viral sequence is listed as a primary case in a 22 year old male in Rahman et al 2021, [here](https://www.sciencedirect.com/science/article/pii/S1201971220322451#tbl0020). District is Rangpur and subdistrict is Sadar.

IEDCR's list of 2014 case counts by district identifies four in Rangpur.

*** Coding to the Sadar upazilla of Rangpur.

```{r}

bgd_110 <- bgd_gadm_3 %>% filter(str_detect(name_2, "Rangpur")) %>%
filter(str_detect(name_3, "Sadar")) %>%
  grab_polygon(110)

```
#bgd_111

Viral sequence is listed as a primary case in a 22 year old male in Rahman et al 2021, [here](https://www.sciencedirect.com/science/article/pii/S1201971220322451#tbl0020). District is Faridpur and subdistrict is Saltha.

IEDCR's list of 2014 case counts by district identifies five in Faridpur

*** Coding to Saltha upazilla
* Check Factiva


```{r}

bgd_111 <- bgd_gadm_3 %>% filter(str_detect(name_3, "Saltha")) %>%
  grab_polygon(111)

```

#bgd_112 / bgd_113

From Dhaka Tribune, archived through the Wayback Machine: "Health specialists have expressed concerns about a potential fresh outbreak of the deadly Nipah virus (NiV), following the confirmation of two recent deaths from NiV infection and four more suspected fatalities.

"Laboratory tests at the Institute of Epidemiology, Disease Control and Research (IEDCR) has confirmed that two boys – aged 13 and 14 – died from NiV infection at Shibaloy and Ghior of Manikganj district on the last week of December last year.Both of them died after being infected with the virus by drinking raw date-palm sap (Khejurer Rosh)."

[link](https://web.archive.org/web/20140525203226/http://www.dhakatribune.com/safety/2014/jan/12/fears-nipah-virus-outbreak-following-2-confirmed-deaths)

*** Coding to Shibalaya and Ghior upazillas

```{r}

bgd_112 <- bgd_gadm_3 %>% 
  filter(str_detect(name_3, "Shibalaya")) %>%
  grab_polygon(112)

bgd_113 <- bgd_gadm_3 %>% 
  filter(str_detect(name_3, "Ghior")) %>%
  grab_polygon(113)

```


#bgd_114

Viral sequence is listed as a primary case in a 14 year old male in Rahman et al 2021, [here](https://www.sciencedirect.com/science/article/pii/S1201971220322451#tbl0020). District is Magura and subdistrict Sadar.

IEDCR's list of 2014 case counts by district identifies five in Magura

** Coding to Magura Sadar upazilla

```{r}

bgd_114 <- bgd_gadm_3 %>% filter(str_detect(name_3, "Magura Sadar")) %>%
  grab_polygon(114)

```
#bgd_115 

Viral sequence is listed as a primary case in a 7 year old male in Rahman et al 2021, [here](https://www.sciencedirect.com/science/article/pii/S1201971220322451#tbl0020). District is Gopalganj and subdistrict is Mokshedpur.

GADM data transliterates as more standard Muksudpur, which data [here](https://moa.portal.gov.bd/sites/default/files/files/moa.portal.gov.bd/page/7bd6781d_6460_4531_8df7_84c90ed2c8b4/Gopalganj-12.03.2020.pdf) makes clear is equivalent. 

*** Coding to Muksudpur upazilla
* Check Factiva

```{r}

bgd_115 <- bgd_gadm_3 %>% filter(str_detect(name_3, "Muksudpur")) %>%
  grab_polygon(115)

```

#bgd_116

Viral sequence is listed as a primary case in a 36 year old male in Rahman et al 2021, [here](https://www.sciencedirect.com/science/article/pii/S1201971220322451#tbl0020). District is Madaripur and subdistrict Shibchar.

*** Coding to upazilla Shib Char 
* Check Factiva

```{r}

bgd_116 <- bgd_gadm_3 %>% filter(str_detect(name_3, "Shib Char")) %>%
  grab_polygon(116)

```

#bgd_117

Viral sequence is listed as a primary case in a 42 year old male in Rahman et al 2021, [here](https://www.sciencedirect.com/science/article/pii/S1201971220322451#tbl0020). District is Rajshahi and subdistrict Bagha.

***Coding to Bagha upazilla
* Check FActiva

```{r}

bgd_117 <- bgd_gadm_3 %>% filter(str_detect(name_2, "Rajshahi")) %>%
  filter(str_detect(name_3, "Bagha")) %>%
  grab_polygon(117)

```

#bgd_118

Mymensingh district appears on the IEDCR case list for 2013 [here](https://webcache.googleusercontent.com/search?q=cache:bjtu4Hc2QRQJ:www.iedcr.gov.bd/index.php/component/content/article/11/135-23-rd-february-2013-nipah-outbreak+&cd=1&hl=en&ct=clnk&gl=ca), and is repeated in an academic paper that cites IEDCR for districts with cases that year [here](http://ebaub.edu.bd/journal/ej/files/vol3/jc3_6.pdf).

[This](https://www.thenewhumanitarian.org/news/2013/02/05/fresh-outbreak-nipah-virus-bangladesh) news story notes that the Dhaka cases coded earlier, bgd_24, came from sap coillected in from Mymensingh. But there are several cases in teh bulletin, suggesting another spillover

*** Coding to Mymensingh district

```{r}

bgd_118 <- bgd_gadm_2 %>% 
  filter(str_detect(name_2, "Mymensingh")) %>%
  grab_polygon(118)


```

#bgd_119

Nilphamari district appears on the IEDCR case list for 2013 [here](https://webcache.googleusercontent.com/search?q=cache:bjtu4Hc2QRQJ:www.iedcr.gov.bd/index.php/component/content/article/11/135-23-rd-february-2013-nipah-outbreak+&cd=1&hl=en&ct=clnk&gl=ca), and is repeated in an academic paper that cites IEDCR for districts with cases that year [here](http://ebaub.edu.bd/journal/ej/files/vol3/jc3_6.pdf).

*** Coding to Nilphamari

```{r}

bgd_119 <- bgd_gadm_2 %>% 
  filter(str_detect(name_2, "Nilphamari")) %>%
  grab_polygon(119)

```

#bgd_120

Naogaon district appears on the IEDCR case list for 2013 [here](https://webcache.googleusercontent.com/search?q=cache:bjtu4Hc2QRQJ:www.iedcr.gov.bd/index.php/component/content/article/11/135-23-rd-february-2013-nipah-outbreak+&cd=1&hl=en&ct=clnk&gl=ca).

Coding this separately from bgd_32, a specific spillover involving an 8 year old in the same district in 2013, because IEDCR lists additional patients later in thier table. 

*** Coding to Naogaon

```{r}

bgd_120 <- bgd_gadm_2 %>% filter(str_detect(name_2, "Naogaon")) %>%
  grab_polygon(120)

```

#bgd_121

Rajbari district appears on the IEDCR case list for 2013 [here](https://webcache.googleusercontent.com/search?q=cache:bjtu4Hc2QRQJ:www.iedcr.gov.bd/index.php/component/content/article/11/135-23-rd-february-2013-nipah-outbreak+&cd=1&hl=en&ct=clnk&gl=ca) as a 24 year old male who died.

* Coding to Rajbari district

```{r}

bgd_121 <- bgd_gadm_2 %>% filter(str_detect(name_2, "Rajbari")) %>%
  grab_polygon(121)

```

#bgd_122

Jhenaidah district appears on the IEDCR case list for 2013 [here](https://webcache.googleusercontent.com/search?q=cache:bjtu4Hc2QRQJ:www.iedcr.gov.bd/index.php/component/content/article/11/135-23-rd-february-2013-nipah-outbreak+&cd=1&hl=en&ct=clnk&gl=ca) as a 11 year old male who died.

* Coding to Jhenaidah district

```{r}

bgd_122 <- bgd_gadm_2 %>% 
  filter(str_detect(name_2, "Jhenaidah")) %>%
  grab_polygon(122)

```

#bgd_123

Faridpur district appears on the IEDCR case list for Dec 2013 - February 27, 2014, archived through Google's cache [here](https://webcache.googleusercontent.com/search?q=cache:lL29-kGy1uEJ:https://www.iedcr.gov.bd/pdf/files/nipah/Nipah%2520Infection_27.02.2014.pdf+&cd=3&hl=en&ct=clnk&gl=ca)

* Coding to Faridpur district

```{r}

bgd_123 <- bgd_gadm_2 %>% 
  filter(str_detect(name_2, "Faridpur")) %>%
  grab_polygon(123)

```

#bgd_124

Shariatpur district appears on the IEDCR case list for Dec 2013 - February 27, 2014, archived through Google's cache [here](https://webcache.googleusercontent.com/search?q=cache:lL29-kGy1uEJ:https://www.iedcr.gov.bd/pdf/files/nipah/Nipah%2520Infection_27.02.2014.pdf+&cd=3&hl=en&ct=clnk&gl=ca)

* Coding to Shariatpur district

```{r}

bgd_124 <- bgd_gadm_2 %>%
  filter(str_detect(name_2, "Shariatpur")) %>%
  grab_polygon(124)

```